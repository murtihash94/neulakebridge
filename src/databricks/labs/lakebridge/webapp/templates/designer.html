{% extends "base.html" %}

{% block title %}Visual Designer - Lakebridge{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12">
            <div class="text-center mb-4">
                <h2 class="fw-bold">
                    <i class="fas fa-sitemap text-primary me-2"></i>Digital Workers in Agentbricks
                </h2>
                <p class="text-muted">Design and manage your migration agents and tasks</p>
            </div>
        </div>
    </div>

    <!-- Agents Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0"><i class="fas fa-robot me-2" style="color: #2563eb;"></i>Migration Agents</h3>
                <button class="btn btn-primary" id="addAgentBtn">
                    <i class="fas fa-plus me-1"></i>Add Agent
                </button>
            </div>
            <div class="row g-3" id="agentsContainer">
                {% for agent in agents %}
                <div class="col-md-6 col-lg-4">
                    <div class="card agent-card h-100 shadow-sm" data-agent-id="{{ agent.id }}">
                        <div class="card-header" style="background: linear-gradient(135deg, {{ agent.color_start }} 0%, {{ agent.color_end }} 100%); color: white;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas {{ agent.icon }} me-2"></i>{{ agent.name }}
                                </h5>
                                <span class="badge bg-light text-dark">{{ agent.status }}</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text">{{ agent.description }}</p>
                            <div class="mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-layer-group me-1"></i>Type: {{ agent.type }}
                                </small>
                            </div>
                            <div class="mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-tasks me-1"></i>Tasks: {{ agent.task_count }}
                                </small>
                            </div>
                            <div class="mb-3">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>Last Run: {{ agent.last_run }}
                                </small>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-primary flex-fill view-tasks-btn" data-agent-id="{{ agent.id }}">
                                    <i class="fas fa-eye me-1"></i>View Tasks
                                </button>
                                <button class="btn btn-sm btn-outline-primary edit-agent-btn" data-agent-id="{{ agent.id }}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-agent-btn" data-agent-id="{{ agent.id }}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Tasks Section -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0"><i class="fas fa-tasks me-2" style="color: #3d8fcf;"></i>Migration Tasks</h3>
                <button class="btn btn-primary" id="addTaskBtn">
                    <i class="fas fa-plus me-1"></i>Add Task
                </button>
            </div>
            
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead style="background-color: #e0f2fe;">
                                <tr>
                                    <th><i class="fas fa-check-circle me-1"></i>Status</th>
                                    <th><i class="fas fa-tag me-1"></i>Task Name</th>
                                    <th><i class="fas fa-robot me-1"></i>Agent</th>
                                    <th><i class="fas fa-layer-group me-1"></i>Type</th>
                                    <th><i class="fas fa-percentage me-1"></i>Progress</th>
                                    <th><i class="fas fa-cog me-1"></i>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                {% for task in tasks %}
                                <tr data-task-id="{{ task.id }}" class="task-row">
                                    <td>
                                        <span class="badge" style="background-color: {{ task.status_color }};">
                                            <i class="fas {{ task.status_icon }} me-1"></i>{{ task.status }}
                                        </span>
                                    </td>
                                    <td><strong>{{ task.name }}</strong></td>
                                    <td>
                                        <span class="badge" style="background-color: {{ task.agent_color }};">
                                            {{ task.agent_name }}
                                        </span>
                                    </td>
                                    <td>{{ task.type }}</td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" 
                                                 style="width: {{ task.progress }}%; background-color: #3d8fcf;" 
                                                 aria-valuenow="{{ task.progress }}" aria-valuemin="0" aria-valuemax="100">
                                                {{ task.progress }}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary view-task-btn" data-task-id="{{ task.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-success run-task-btn" data-task-id="{{ task.id }}">
                                                <i class="fas fa-play"></i>
                                            </button>
                                            <button class="btn btn-outline-danger delete-task-btn" data-task-id="{{ task.id }}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workflow Visualization -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-3"><i class="fas fa-project-diagram me-2" style="color: #1a4d7a;"></i>Workflow Visualization</h3>
            <div class="card shadow-sm">
                <div class="card-body" style="background: linear-gradient(135deg, #f0f7ff 0%, #e0f2fe 100%);">
                    <div id="workflowCanvas" style="min-height: 400px; position: relative; padding: 2rem;">
                        <div class="text-center py-5">
                            <i class="fas fa-project-diagram fa-4x mb-3" style="color: #3d8fcf;"></i>
                            <h5>Workflow Diagram</h5>
                            <p class="text-muted">Visual representation of your migration workflow</p>
                            <div class="workflow-preview mt-4">
                                {% for agent in agents %}
                                <div class="workflow-node" style="display: inline-block; margin: 10px; padding: 15px 25px; border-radius: 10px; background: linear-gradient(135deg, {{ agent.color_start }} 0%, {{ agent.color_end }} 100%); color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <i class="fas {{ agent.icon }} me-2"></i>{{ agent.name }}
                                </div>
                                {% if not loop.last %}
                                <i class="fas fa-arrow-right mx-2" style="color: #2563eb;"></i>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .agent-card {
        border: 2px solid #60a5fa;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
    }
    
    .agent-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        border-color: #2563eb;
    }
    
    .task-row {
        transition: background-color 0.2s ease;
    }
    
    .task-row:hover {
        background-color: #dbeafe;
    }
    
    .workflow-node {
        animation: fadeInUp 0.5s ease-in-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add Agent button
        document.getElementById('addAgentBtn').addEventListener('click', function() {
            alert('Add Agent functionality - Coming soon!');
        });
        
        // Add Task button
        document.getElementById('addTaskBtn').addEventListener('click', function() {
            alert('Add Task functionality - Coming soon!');
        });
        
        // View Tasks buttons
        document.querySelectorAll('.view-tasks-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const agentId = this.getAttribute('data-agent-id');
                alert('Viewing tasks for Agent ID: ' + agentId);
            });
        });
        
        // Edit Agent buttons
        document.querySelectorAll('.edit-agent-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const agentId = this.getAttribute('data-agent-id');
                alert('Editing Agent ID: ' + agentId);
            });
        });
        
        // Delete Agent buttons
        document.querySelectorAll('.delete-agent-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const agentId = this.getAttribute('data-agent-id');
                if (confirm('Are you sure you want to delete this agent?')) {
                    alert('Deleting Agent ID: ' + agentId);
                }
            });
        });
        
        // View Task buttons
        document.querySelectorAll('.view-task-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const taskId = this.getAttribute('data-task-id');
                alert('Viewing Task ID: ' + taskId);
            });
        });
        
        // Run Task buttons
        document.querySelectorAll('.run-task-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const taskId = this.getAttribute('data-task-id');
                alert('Running Task ID: ' + taskId);
            });
        });
        
        // Delete Task buttons
        document.querySelectorAll('.delete-task-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                const taskId = this.getAttribute('data-task-id');
                if (confirm('Are you sure you want to delete this task?')) {
                    alert('Deleting Task ID: ' + taskId);
                }
            });
        });
    });
</script>
{% endblock %}
